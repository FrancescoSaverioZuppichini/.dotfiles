var Dt=Object.create,J=Object.defineProperty,Jt=Object.getPrototypeOf,Ft=Object.prototype.hasOwnProperty,Ht=Object.getOwnPropertyNames,Gt=Object.getOwnPropertyDescriptor;var _=Object.assign,me=e=>J(e,"__esModule",{value:!0});var c=(e,r)=>()=>(r||(r={exports:{}},e(r.exports,r)),r.exports),Mt=(e,r)=>{for(var n in r)J(e,n,{get:r[n],enumerable:!0})},Yt=(e,r,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of Ht(r))!Ft.call(e,t)&&t!=="default"&&J(e,t,{get:()=>r[t],enumerable:!(n=Gt(r,t))||n.enumerable});return e},P=e=>Yt(me(J(e!=null?Dt(Jt(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var ee=c((Ni,_e)=>{_e.exports=function(r,n,t){r(n),t&&t(n===!0?null:n)}});var F=c((Ii,Ee)=>{"use strict";var ke=ee();Ee.exports=function(r,n){if(!r)return function(u,i){return u?ke(i,u,n):i(!0)};Array.isArray(r)||(r=Object.keys(r).map(function(u){return r[u]}));var t=0;return function(u,i){if(u)return ke(i,u,n);t>=r.length?i(!0):i(null,r[t++])}}});var Be=c((Ri,Se)=>{"use strict";var Kt=F();Se.exports=function(e){return Kt(Object.keys(e))}});var re=c((Li,Pe)=>{"use strict";var Wt=ee();Pe.exports=function(r,n){return function(t,u){if(t)return Wt(u,t,n);if(r!=null){var i=r;r=null,u(null,i)}else u(!0)}}});var Ae=c((Ui,Oe)=>{"use strict";Oe.exports=function(r){var n=0;return r=r||Infinity,function(t,u){if(t)return u&&u(t);if(n>r)return u(!0);u(null,n++)}}});var Ce=c((Di,Te)=>{"use strict";Te.exports=function(r){return r=r||Math.random,function(n,t){return n?t&&t(n):t(null,r())}}});var Ie=c((Ji,Ne)=>{"use strict";Ne.exports=function(){return function(r,n){n(!0)}}});var Le=c((Fi,Re)=>{"use strict";Re.exports=function(r){return function(n,t){t(r)}}});var De=c((Hi,Ue)=>{"use strict";Ue.exports={keys:Be(),once:re(),values:F(),count:Ae(),infinite:Ce(),empty:Ie(),error:Le()}});var O=c((Gi,Je)=>{"use strict";Je.exports=function(r,n){var t,u;function i(f){if(t=f,u)return i.abort();(function s(){for(var o=!0,l=!1;o;)if(l=!1,t(null,function(a,p){if(l=!0,a=a||u){if(o=!1,n)n(a===!0?null:a);else if(a&&a!==!0)throw a}else r&&r(p)===!1||u?(o=!1,t(u||!0,n||function(){})):o||s()}),!l){o=!1;return}})()}return i.abort=function(f,s){if(typeof f=="function"&&(s=f,f=!0),u=f||!0,t)return t(u,s||function(){})},i}});var He=c((Mi,Fe)=>{"use strict";var Qt=O();Fe.exports=function(r){return Qt(null,r)}});var Me=c((Yi,Ge)=>{"use strict";var $t=O();Ge.exports=function(r){return $t(function(n){console.log(n)},r)}});var A=c((Ki,Ye)=>{Ye.exports=function(r){return r&&(typeof r=="string"?function(n){return n[r]}:typeof r=="object"&&typeof r.exec=="function"?function(n){var t=r.exec(n);return t&&t[0]}:r)}});var Qe=c((Wi,Ke)=>{"use strict";function We(e){return e}var zt=A(),Vt=O();Ke.exports=function(r,n){var t=!1;return n?r=zt(r)||We:(n=r,r=We),Vt(function(u){if(r(u))return t=!0,n(null,u),!1},function(u){t||n(u===!0?null:u,null)})}});var H=c((Qi,$e)=>{"use strict";var Xt=O();$e.exports=function(r,n,t){t||(t=n,n=null);var u=Xt(function(i){n=r(n,i)},function(i){t(i,n)});return arguments.length===2?function(i){i(null,function(f,s){if(f)return t(f===!0?null:f);n=s,u(i)})}:u}});var Ve=c(($i,ze)=>{"use strict";var Zt=H();ze.exports=function(r){return Zt(function(n,t){return n.push(t),n},[],r)}});var Ze=c((zi,Xe)=>{"use strict";var jt=H();Xe.exports=function(r){return jt(function(n,t){return n+t},"",r)}});var be=c((Vi,je)=>{"use strict";je.exports={drain:O(),onEnd:He(),log:Me(),find:Qe(),reduce:H(),collect:Ve(),concat:Ze()}});var rr=c((Xi,er)=>{"use strict";function bt(e){return e}var eu=A();er.exports=function(r){return r?(r=eu(r),function(n){return function(t,u){n(t,function(i,f){try{f=i?null:r(f)}catch(s){return n(s,function(){return u(s)})}u(i,f)})}}):bt}});var tr=c((Zi,nr)=>{"use strict";function ru(e){return e}var nu=A();nr.exports=function(r){if(!r)return ru;r=nu(r);var n=!1,t,u;return function(i){return function f(s,o){if(u)return o(u);s?(u=s,n?i(s,function(l){n?t=o:o(s)}):i(s,function(l){o(s)})):i(null,function(l,a){l?o(l):u?o(u):(n=!0,r(a,function(p,h){n=!1,u?(o(u),t&&t(u)):p?f(p,o):o(null,h)}))})}}}});var ne=c((ji,ur)=>{var tu=A();function uu(e){return e}ur.exports=function(r){return typeof r=="object"&&typeof r.test=="function"?function(n){return r.test(n)}:tu(r)||uu}});var G=c((bi,ir)=>{"use strict";var iu=ne();ir.exports=function(r){return r=iu(r),function(n){return function t(u,i){for(var f,s=!0;s;)s=!1,f=!0,n(u,function(o,l){if(!o&&!r(l))return f?s=!0:t(o,i);i(o,l)}),f=!1}}}});var sr=c((eo,or)=>{"use strict";var ou=ne(),su=G();or.exports=function(r){return r=ou(r),su(function(n){return!r(n)})}});var lr=c((ro,fr)=>{"use strict";fr.exports=function(r,n){var t=!1;function u(i){t||!n||(t=!0,n(i===!0?null:i))}return function(i){return function(f,s){return f&&u(f),i(f,function(o,l){o?u(o):r&&r(l),s(o,l)})}}}});var ar=c((no,cr)=>{"use strict";cr.exports=function(r,n){n=n||{};var t=n.last||!1,u=!1;if(typeof r=="number"){t=!0;var i=r;r=function(){return--i}}return function(f){function s(o){f(!0,function(l){t=!1,o(l||!0)})}return function(o,l){u&&!o?t?s(l):l(u):(u=o)?f(u,l):f(null,function(a,p){(u=u||a)?l(u):r(p)?l(null,p):(u=!0,t?l(null,p):s(l))})}}}});var te=c((to,pr)=>{"use strict";function fu(e){return e}var lu=A(),cu=G();pr.exports=function(r,n){r=lu(r)||fu;var t={};return cu(function(u){var i=r(u);return t[i]?!!n:(t[i]=!0,!n)})}});var dr=c((uo,hr)=>{"use strict";var au=te();hr.exports=function(r){return au(r,!0)}});var qr=c((io,vr)=>{"use strict";var pu=F(),hu=re();vr.exports=function(){return function(r){var n;return function(t,u){t?n?n(t,function(s){r(s||t,u)}):r(t,u):n?i():f();function i(){n(null,function(s,o){s===!0?f():s?r(!0,function(l){u(s)}):u(null,o)})}function f(){n=null,r(null,function(s,o){if(s)return u(s);Array.isArray(o)||o&&typeof o=="object"?o=pu(o):typeof o!="function"&&(o=hu(o)),n=o,i()})}}}}});var xr=c((oo,yr)=>{"use strict";yr.exports={map:rr(),asyncMap:tr(),filter:G(),filterNot:sr(),through:lr(),take:ar(),unique:te(),nonUnique:dr(),flatten:qr()}});var ue=c((so,gr)=>{"use strict";gr.exports=function e(r){var n=arguments.length;if(typeof r=="function"&&r.length===1){for(var t=new Array(n),u=0;u<n;u++)t[u]=arguments[u];return function(s){if(t==null)throw new TypeError("partial sink should only be called once!");var o=t;switch(t=null,n){case 1:return e(s,o[0]);case 2:return e(s,o[0],o[1]);case 3:return e(s,o[0],o[1],o[2]);case 4:return e(s,o[0],o[1],o[2],o[3]);default:return o.unshift(s),e.apply(null,o)}}}var i=r;i&&typeof i.source=="function"&&(i=i.source);for(var u=1;u<n;u++){var f=arguments[u];typeof f=="function"?i=f(i):f&&typeof f=="object"&&(f.sink(i),i=f.source)}return i}});var M=c((E,wr)=>{"use strict";var mr=De(),_r=be(),Er=xr();E=wr.exports=ue();E.pull=E;for(var w in mr)E[w]=mr[w];for(var w in Er)E[w]=Er[w];for(var w in _r)E[w]=_r[w]});var ie=c((lo,kr)=>{var fo=kr.exports=function(e){(function r(){var n=!0,t=!1,u=!1;do u=!0,n=!1,e.call(this,function(){u?n=!0:r()}),u=!1;while(n)})()}});var Br=c((co,Sr)=>{var du=ie();Sr.exports=function(e,r){return function(n){var t=[],u,i;function f(l){t.push(l)}e=e||function(l){this.queue(l)},r=r||function(){this.queue(null)};var s={emit:function(l,a){l=="data"&&f(a),l=="end"&&(u=!0,f(null)),l=="error"&&(i=a)},queue:f},o;return function(l,a){if(u=u||l,l)return n(l,function(){if(o){var p=o;o=null,p(l)}a(l)});o=a,du(function p(h){if(!!o)if(a=o,i)o=null,a(i);else if(t.length){var d=t.shift();o=null,a(d===null,d)}else n(u,function(v,g){if(v&&v!==!0)return i=v,h();if(u=u||v)r.call(s);else if(g!==null&&(e.call(s,g),i||u))return n(i||u,function(){o=null,a(i||u)});h(p)})})}}}});var Or=c((ao,Pr)=>{Pr.exports=function(){var e=[],r=0;function n(){return e.reduce(function(t,u){return t+u.length},0)}return{length:r,data:this,add:function(t){if(!Buffer.isBuffer(t))throw new Error("data must be a buffer, was: "+JSON.stringify(t));return this.length=r=r+t.length,e.push(t),this},has:function(t){return t==null?r>0:r>=t},get:function(t){var u;if(t==null||t===r){r=0;var i=e;return e=[],i.length==1?i[0]:Buffer.concat(i)}else if(e.length>1&&t<=(u=e[0].length)){var f=e[0].slice(0,t);return t===u?e.shift():e[0]=e[0].slice(t,u),r-=t,f}else if(t<r){for(var s=[],o=0;o+e[0].length<t;){var l=e.shift();o+=l.length,s.push(l)}return o<t&&(s.push(e[0].slice(0,t-o)),e[0]=e[0].slice(t-o,e[0].length),this.length=r=r-t),Buffer.concat(s)}else throw new Error("could not get "+t+" bytes")}}}});var Nr=c((po,Ar)=>{"use strict";var vu=Or();function qu(e){return Number.isFinite(e)}function Tr(e){return typeof e=="function"}function Cr(e,r){return r?function(n,t){var u=setTimeout(function(){e(new Error("pull-reader: read exceeded timeout"),t)},r);e(n,function(i,f){clearTimeout(u),t(i,f)})}:e}Ar.exports=function(e){var r=[],n,t,u=!1,i=vu(),f,s,o;function l(){for(;r.length;)if(r[0].length==null&&i.has(1))r.shift().cb(null,i.get());else if(i.has(r[0].length)){var h=r.shift();h.cb(null,i.get(h.length))}else if(f==!0&&r[0].length&&i.length<r[0].length){var d="stream ended with:"+i.length+" but wanted:"+r[0].length;r.shift().cb(new Error(d))}else if(f)r.shift().cb(f);else return!!r.length;return r.length||!i.has(1)||o}function a(){var h=l();h&&!u&&n&&!u&&!s&&(u=!0,t(null,function(d,v){if(u=!1,d)return f=d,l();i.add(v),a()}))}function p(h){if(o){for(;r.length;)r.shift().cb(o);return cb&&cb(o)}t=Cr(h,e),n=h,a()}return p.abort=function(h,d){o=h||!0,n?(u=!0,n(o,function(){for(;r.length;)r.shift().cb(o);d&&d(o)})):d()},p.read=function(h,d,v){if(Tr(d)&&(v=d,d=e),Tr(v))r.push({length:qu(h)?h:null,cb:v}),a();else return s=!0,function(g,I){if(u||i.has(1)){if(g)return n(g,I);r.push({length:null,cb:I}),a()}else Cr(n,d)(g,function(Lt,Ut){I(Lt,Ut)})}},p}});var Kr=c((k,Ir)=>{var yu=Br(),xu=Nr(),Rr=0,Lr=1,Ur=2,Dr="GOODBYE",gu=Buffer.isBuffer;function Jr(e){return typeof e=="string"}function Fr(e){var r=Buffer.alloc(9),n=0,t=e.value!==void 0?e.value:e.end;return Jr(e)&&e===Dr?(r.fill(0),[r,null]):(Jr(t)?(n=Lr,t=Buffer.from(t,"utf-8")):gu(t)?n=Rr:(n=Ur,t=Buffer.from(JSON.stringify(t),"utf-8")),n=e.stream<<3|e.end<<2|n,r[0]=n,r.writeUInt32BE(t.length,1),r.writeInt32BE(e.req||0,5),[r,t])}function Hr(e){if(e.length!=9)throw new Error("expected header to be 9 bytes long");var r=e[0],n=e.readUInt32BE(1),t=e.readInt32BE(5);return{req:t,stream:!!(r&8),end:!!(r&4),value:null,length:n,type:r&3}}function Gr(e,r){if(e.length!==r.length)throw new Error("incorrect length, expected:"+r.length+" found:"+e.length);if(Rr===r.type)r.value=e;else if(Lr===r.type)r.value=e.toString();else if(Ur===r.type)r.value=JSON.parse(e.toString());else throw new Error("unknown message type");return r}function Mr(){return yu(function(e){var r=Fr(e);this.queue(r[0]),r[1]!==null&&this.queue(r[1])})}function Yr(){var e=xu(),r=!1;return function(n){return e(n),function(t,u){if(r)return u(!0);if(t)return e.abort(t,u);e.read(9,function(i,f){if(i)return u(i);var s=Hr(f);if(s.length===0)return r=!0,u(null,Dr);e.read(s.length,function(o,l){if(o)return u(o);try{Gr(l,s)}catch(a){return u(a)}u(null,s)})})}}}k=Ir.exports=function(e){return{source:Mr()(e.source),sink:function(r){return e.sink(Yr()(r))}}};k.encodePair=Fr;k.decodeHead=Hr;k.decodeBody=Gr;k.encode=Mr;k.decode=Yr});var $r=c((ho,Wr)=>{function R(e){return e&&(e===!0?!0:{message:e.message,name:e.name,stack:e.stack})}Wr.exports=function(e){return new q(e)};function q(e){this.ended=!1,this.opts=e,this._req_counter=1,this._requests={},this._instreams={},this._outstreams={},this._closecbs=[],this._closing=!1,this._closed=!1,e.close&&this._closecbs.push(e.close)}q.prototype.message=function(e){this.read({req:0,stream:!1,end:!1,value:e})};q.prototype.request=function(e,r){if(this._closing)return r(new Error("parent stream is closing"));var n=this._req_counter++,t=this;this._requests[n]=function(u,i){delete t._requests[n],r(u,i),t._maybedone(u)},this.read({req:n,stream:!1,end:!1,value:e})};q.prototype.stream=function(){if(this._closing)throw new Error("parent stream is closing");var e=this._req_counter++,r=this;return this._outstreams[e]=new L(e,this,function(){delete r._outstreams[e]}),this._outstreams[e]};q.prototype.close=function(e){if(!e)throw new Error("packet-stream.close *must* have callback");if(this._closed)return e();this._closecbs.push(e),this._closing=!0,this._maybedone()};q.prototype.destroy=function(e){e=e||R(e),this.ended=e,this._closing=!0;var r=e===!0?new Error("unexpected end of parent stream"):e,n=0;for(var t in this._requests)n++,this._requests[t](r);for(var t in this._instreams)n++,this._instreams[t].writeEnd=!0,this._instreams[t].destroy(r);for(var t in this._outstreams)n++,this._outstreams[t].writeEnd=!0,this._outstreams[t].destroy(r);n===0&&e===!0&&(r=null),this._maybedone(r)};q.prototype._maybedone=function(e){this._closed||!this._closing||Object.keys(this._requests).length!==0||Object.keys(this._instreams).length!==0||Object.keys(this._outstreams).length!==0||(this._closed=!0,this._closecbs.forEach(function(r){r(e)}),this.read(null,e||!0),this.opts=null,this._closecbs.length=0,this.read=Qr)};function Qr(e){console.error("packet-stream asked to read after closed",e)}q.prototype.read=function(e){console.error("please overwrite read method to do IO",e)};q.prototype.write=function(e,r){this.ended||(r?this.destroy(r):e.req&&!e.stream?this._onrequest(e):e.req&&e.stream?this._onstream(e):this._onmessage(e))};q.prototype._onmessage=function(e){this.opts&&typeof this.opts.message=="function"&&this.opts.message(e.value)};q.prototype._onrequest=function(e){var r=e.req*-1;if(e.req<0)typeof this._requests[r]=="function"&&this._requests[r](e.end?e.value:null,e.end?null:e.value);else if(this.opts&&typeof this.opts.request=="function"){var n=!1,t=this;this.opts.request(e.value,function(i,f){if(n)throw new Error("cb called twice from local api");n=!0,i?t.read({value:R(i),end:!0,req:r}):t.read({value:f,end:!1,req:r}),t._maybedone()})}else{if(this.ended){var u=this.ended===!0?new Error("unexpected end of parent stream"):this.ended;this.read({value:R(u),end:!0,stream:!1,req:r})}else this.read({value:{message:"Unable to handle requests",name:"NO_REQUEST_HANDLER",stack:null},end:!0,stream:!1,req:r});this._maybedone()}};q.prototype._onstream=function(e){if(e.req<0){var r=e.req*-1,n=this._outstreams[r];if(!n)return console.error("no stream for incoming msg",e);e.end?(n.writeEnd&&delete this._outstreams[r],n.readEnd=!0,n.read(null,e.value),this._maybedone()):n.read(e.value)}else{var r=e.req,t=this._instreams[r];if(!t){var u=this;t=this._instreams[r]=new L(r*-1,this,function(){delete u._instreams[r]}),this.opts&&typeof this.opts.stream=="function"&&this.opts.stream(t)}e.end?(t.writeEnd&&delete this._instreams[r],t.readEnd=!0,t.read&&t.read(null,e.value),this._maybedone()):t.read?t.read(e.value):console.error("no .read for stream:",t.id,"dropped:",e)}};function L(e,r,n){this.id=e,this.read=null,this.writeEnd=null,this.readEnd=null,this._ps=r,this._remove=n,this._seq_counter=1}L.prototype.write=function(e,r){if(r){this.writeEnd=r;var n=this._ps;n&&(n.read({req:this.id,stream:!0,end:!0,value:R(r)}),this.readEnd&&this.destroy(r),n._maybedone(r))}else this._ps&&this._ps.read({req:this.id,stream:!0,end:!1,value:e})};L.prototype.end=function(e){this.write(null,R(e||!0))};L.prototype.destroy=function(e){if(this.writeEnd){if(!this.readEnd){this.readEnd=!0;try{this.read&&this.read(null,e)}catch(r){console.error("Exception thrown by PacketStream substream end handler",r),console.error(r.stack)}}}else{if(this.writeEnd=!0,!this.readEnd){this.readEnd=!0;try{this.read(null,e)}catch(r){console.error("Exception thrown by PacketStream substream end handler",r),console.error(r.stack)}}this.write(null,e)}this._ps&&(this._remove(),this._remove=null,this.read=Qr,this._ps=null)}});var Vr=c((vo,S)=>{"use strict";var wu=M();function mu(e){var r=!1;return function(n,t){r||(r=!0,e(n,t))}}S.exports=function(e,r){var n=[],t=!1,u,i,f=mu(function(s,o){r&&r(s,o),e=null,r=null,u=null,i&&i(s||!0,function(){})});return e.read=function(s,o){if(t=t||o,u){var l=u;u=null,l(t,s)}else t||n.push(s);t&&f(t!==!0?t:null)},{source:function(s,o){s?(e&&e.write(null,s),o(s),f(s!==!0?s:null)):n.length?o(null,n.shift()):t?o(t):u=o},sink:function(s){if(t)return s(t,function(){}),i=null;i=s,wu.drain(function(o){if(t)return!1;e.write(o)},function(o){e&&!e.writeEnd&&e.write(null,o||!0),f&&f(o)})(s)}}};function zr(e,r){return S.exports(e,function(n){e.writeEnd||e.write(null,n||!0),r&&r(n)})}S.exports.source=function(e){return zr(e).source};S.exports.sink=function(e,r){return zr(e,r).sink};S.exports.duplex=S.exports});var Zr=c((qo,Xr)=>{Xr.exports=function(r){var n,t,u;function i(f){return function(s,o){f(s,function(l,a){if(l&&!u)return u=!0,o(null,r);l&&n?o(l):l?t=o:o(null,a)})}}return i.end=function(){return n=!0,t&&t(n),i},i}});var oe=c((yo,jr)=>{jr.exports=function(r,n,t){r(n),t&&t(n===!0?null:n)}});var Y=c((xo,br)=>{"use strict";var en=oe();br.exports=function(r,n){if(!r)return function(u,i){return u?en(i,u,n):i(!0)};Array.isArray(r)||(r=Object.keys(r).map(function(u){return r[u]}));var t=0;return function(u,i){if(u)return en(i,u,n);t>=r.length?i(!0):i(null,r[t++])}}});var nn=c((go,rn)=>{"use strict";var _u=Y();rn.exports=function(e){return _u(Object.keys(e))}});var se=c((wo,tn)=>{"use strict";var Eu=oe();tn.exports=function(r,n){return function(t,u){if(t)return Eu(u,t,n);if(r!=null){var i=r;r=null,u(null,i)}else u(!0)}}});var on=c((mo,un)=>{"use strict";un.exports=function(r){var n=0;return r=r||Infinity,function(t,u){if(t)return u&&u(t);if(n>r)return u(!0);u(null,n++)}}});var fn=c((_o,sn)=>{"use strict";sn.exports=function(r){return r=r||Math.random,function(n,t){return n?t&&t(n):t(null,r())}}});var cn=c((Eo,ln)=>{"use strict";ln.exports=function(){return function(r,n){n(!0)}}});var pn=c((ko,an)=>{"use strict";an.exports=function(r){return function(n,t){t(r)}}});var dn=c((So,hn)=>{"use strict";hn.exports={keys:nn(),once:se(),values:Y(),count:on(),infinite:fn(),empty:cn(),error:pn()}});var T=c((Bo,vn)=>{"use strict";vn.exports=function(r,n){var t,u;function i(f){if(t=f,u)return i.abort();(function s(){for(var o=!0,l=!1;o;)if(l=!1,t(null,function(a,p){if(l=!0,a=a||u){if(o=!1,n)n(a===!0?null:a);else if(a&&a!==!0)throw a}else r&&r(p)===!1||u?(o=!1,t(u||!0,n||function(){})):o||s()}),!l){o=!1;return}})()}return i.abort=function(f,s){if(typeof f=="function"&&(s=f,f=!0),u=f||!0,t)return t(u,s||function(){})},i}});var yn=c((Po,qn)=>{"use strict";var ku=T();qn.exports=function(r){return ku(null,r)}});var gn=c((Oo,xn)=>{"use strict";var Su=T();xn.exports=function(r){return Su(function(n){console.log(n)},r)}});var C=c((Ao,wn)=>{wn.exports=function(r){return r&&(typeof r=="string"?function(n){return n[r]}:typeof r=="object"&&typeof r.exec=="function"?function(n){var t=r.exec(n);return t&&t[0]}:r)}});var En=c((To,mn)=>{"use strict";function _n(e){return e}var Bu=C(),Pu=T();mn.exports=function(r,n){var t=!1;return n?r=Bu(r)||_n:(n=r,r=_n),Pu(function(u){if(r(u))return t=!0,n(null,u),!1},function(u){t||n(u===!0?null:u,null)})}});var K=c((Co,kn)=>{"use strict";var Ou=T();kn.exports=function(r,n,t){t||(t=n,n=null);var u=Ou(function(i){n=r(n,i)},function(i){t(i,n)});return arguments.length===2?function(i){i(null,function(f,s){if(f)return t(f===!0?null:f);n=s,u(i)})}:u}});var Bn=c((No,Sn)=>{"use strict";var Au=K();Sn.exports=function(r){return Au(function(n,t){return n.push(t),n},[],r)}});var On=c((Io,Pn)=>{"use strict";var Tu=K();Pn.exports=function(r){return Tu(function(n,t){return n+t},"",r)}});var Tn=c((Ro,An)=>{"use strict";An.exports={drain:T(),onEnd:yn(),log:gn(),find:En(),reduce:K(),collect:Bn(),concat:On()}});var Nn=c((Lo,Cn)=>{"use strict";function Cu(e){return e}var Nu=C();Cn.exports=function(r){return r?(r=Nu(r),function(n){return function(t,u){n(t,function(i,f){try{f=i?null:r(f)}catch(s){return n(s,function(){return u(s)})}u(i,f)})}}):Cu}});var Rn=c((Uo,In)=>{"use strict";function Iu(e){return e}var Ru=C();In.exports=function(r){if(!r)return Iu;r=Ru(r);var n=!1,t,u;return function(i){return function f(s,o){if(u)return o(u);s?(u=s,n?i(s,function(){n?t=o:o(s)}):i(s,o)):i(null,function(l,a){l?o(l):u?o(u):(n=!0,r(a,function(p,h){n=!1,u?(o(u),t(u)):p?f(p,o):o(null,h)}))})}}}});var fe=c((Do,Ln)=>{var Lu=C();function Uu(e){return e}Ln.exports=function(r){return typeof r=="object"&&typeof r.test=="function"?function(n){return r.test(n)}:Lu(r)||Uu}});var W=c((Jo,Un)=>{"use strict";var Du=fe();Un.exports=function(r){return r=Du(r),function(n){return function t(u,i){for(var f,s=!0;s;)s=!1,f=!0,n(u,function(o,l){if(!o&&!r(l))return f?s=!0:t(o,i);i(o,l)}),f=!1}}}});var Jn=c((Fo,Dn)=>{"use strict";var Ju=fe(),Fu=W();Dn.exports=function(r){return r=Ju(r),Fu(function(n){return!r(n)})}});var Hn=c((Ho,Fn)=>{"use strict";Fn.exports=function(r,n){var t=!1;function u(i){t||!n||(t=!0,n(i===!0?null:i))}return function(i){return function(f,s){return f&&u(f),i(f,function(o,l){o?u(o):r&&r(l),s(o,l)})}}}});var Mn=c((Go,Gn)=>{"use strict";Gn.exports=function(r,n){n=n||{};var t=n.last||!1,u=!1;if(typeof r=="number"){t=!0;var i=r;r=function(){return--i}}return function(f){function s(o){f(!0,function(l){t=!1,o(l||!0)})}return function(o,l){u?t?s(l):l(u):(u=o)?f(u,l):f(null,function(a,p){(u=u||a)?l(u):r(p)?l(null,p):(u=!0,t?l(null,p):s(l))})}}}});var le=c((Mo,Yn)=>{"use strict";function Hu(e){return e}var Gu=C(),Mu=W();Yn.exports=function(r,n){r=Gu(r)||Hu;var t={};return Mu(function(u){var i=r(u);return t[i]?!!n:(t[i]=!0,!n)})}});var Wn=c((Yo,Kn)=>{"use strict";var Yu=le();Kn.exports=function(r){return Yu(r,!0)}});var $n=c((Ko,Qn)=>{"use strict";var Ku=Y(),Wu=se();Qn.exports=function(){return function(r){var n;return function(t,u){t?n?n(t,function(s){r(s||t,u)}):r(t,u):n?i():f();function i(){n(null,function(s,o){s===!0?f():s?r(!0,function(l){u(s)}):u(null,o)})}function f(){n=null,r(null,function(s,o){if(s)return u(s);Array.isArray(o)||o&&typeof o=="object"?o=Ku(o):typeof o!="function"&&(o=Wu(o)),n=o,i()})}}}}});var Vn=c((Wo,zn)=>{"use strict";zn.exports={map:Nn(),asyncMap:Rn(),filter:W(),filterNot:Jn(),through:Hn(),take:Mn(),unique:le(),nonUnique:Wn(),flatten:$n()}});var Zn=c((Qo,Xn)=>{"use strict";Xn.exports=function e(r){var n=arguments.length;if(typeof r=="function"&&r.length===1){for(var t=new Array(n),u=0;u<n;u++)t[u]=arguments[u];return function(s){if(t==null)throw new TypeError("partial sink should only be called once!");var o=t;switch(t=null,n){case 1:return e(s,o[0]);case 2:return e(s,o[0],o[1]);case 3:return e(s,o[0],o[1],o[2]);case 4:return e(s,o[0],o[1],o[2],o[3]);default:return o.unshift(s),e.apply(null,o)}}}var i=r;i&&typeof i.source=="function"&&(i=i.source);for(var u=1;u<n;u++){var f=arguments[u];typeof f=="function"?i=f(i):f&&typeof f=="object"&&(f.sink(i),i=f.source)}return i}});var nt=c((U,jn)=>{"use strict";var bn=dn(),et=Tn(),rt=Vn();U=jn.exports=Zn();for(var m in bn)U[m]=bn[m];for(var m in rt)U[m]=rt[m];for(var m in et)U[m]=et[m]});var ut=c(($o,tt)=>{var Qu=Zr(),ce=nt();tt.exports=function(e,r){r=r||"GOODBYE";var n=Qu(r);return{source:ce(e.source,n),sink:ce(ce.filter(function(t){if(t!==r)return!0;n.end()}),e.sink)}}});var D=c(y=>{"use strict";var Q=M();function $u(e){return typeof e=="string"}function zu(e){for(var r in e)return!1;return!0}y.set=function(e,r,n){for(var t,u,i=0;i<r.length;i++){var f=r[i];e[f]=e[f]||{},t=e,u=f,e=e[f]}t[u]=n};y.get=function(e,r){if($u(r))return e[r];for(var n,t=0;t<r.length;t++){var u=r[t];if(n=e=e[u],e==null)return e}return n};y.prefix=function(e,r){for(var n,t=0;t<r.length;t++){var u=r[t];if(n=e=e[u],typeof e!="object")return e}return typeof n!="object"?!!n:!1};function Vu(e,r){for(var n in r){var t=r[n];e[t]||(e[t]={}),e=e[t]}return e}function Xu(e,r){(function n(t,u){var i=r[u];if(t)r.length-1===u?delete t[i]:u<r.length&&n(t[i],u+1);else return;zu(t[i])&&delete t[i]})(e,0)}function Zu(e,r){for(var n in r)e[n]=r[n];return e}y.mount=function(e,r,n){if(!Array.isArray(r))throw new Error("path must be array of strings");return Zu(Vu(e,r),n)};y.unmount=function(e,r){return Xu(e,r)};function ae(e){return e==="source"}function pe(e){return e==="sink"}function ju(e){return e==="duplex"}function bu(e){return e==="sync"}function ei(e){return e==="async"}function ri(e){return bu(e)||ei(e)}function he(e){return function(r){r(e||!0,function(){})}}function it(e){return{source:Q.error(e),sink:he(e)}}y.errorAsStream=function(e,r){return ae(e)?Q.error(r):pe(e)?he(r):it(r)};y.errorAsStreamOrCb=function(e,r,n){return ri(e)?n(r):ae(e)?Q.error(r):pe(e)?he(r):n(r),it(r)};y.pipeToStream=function(e,r,n){ae(e)?r(n):pe(e)?n(r):ju(e)&&Q(r,n,r)}});var de=c((Xo,ot)=>{function st(e){if(e.stack&&e.name&&e.message)return e.stack.substring(e.name.length+3+e.message.length).split(`
`);if(e.stack)return e.stack.split(`
`)}function ni(e,r){return e.filter(function(n){return!~r.indexOf(n)})}var Vo=ot.exports=function(e,r){if(!(e.stack&&e.name&&e.message))return console.error(new Error("stackless error")),e;var n=new Error(r),t=ni(st(n).slice(1),st(e)).join(`
`);return n.__proto__=e,n.stack=n.name+": "+n.message+`
`+t+`
  `+e.stack,n}});var ht=c((Zo,ft)=>{"use strict";var ti=$r(),ve=Vr(),ui=ut(),lt=D(),ct=de();function ii(e){return typeof e=="function"}function oi(e){return e==="source"}function si(e){return e==="sink"}function fi(e){return e==="duplex"}function li(e){return e==="sync"}function ci(e){return e==="async"}function at(e){return li(e)||ci(e)}function pt(e){return oi(e)||si(e)||fi(e)}ft.exports=function(r,n,t){var u=ti({message:function(){},request:function(f,s){if(!Array.isArray(f.args))return s(new Error("invalid request, args should be array, was:"+JSON.stringify(f)));var o=f.name,l=f.args,a=!1,p=!1;l.push(function(h,d){p=!0,a=!0,s(h,d)});try{r("async",o,l)}catch(h){if(a||p)throw ct(h,"no callback provided to muxrpc async funtion");return s(h)}},stream:function(f){f.read=function(s,o){if(o)return f.write(null,o);var l=s.name,a=s.type,p,h;if(f.read=null,!pt(a))return f.write(null,new Error("unsupported stream type:"+a));try{h=r(a,l,s.args)}catch(v){p=v}var d=ve[{source:"sink",sink:"source"}[a]||"duplex"](f);return lt.pipeToStream(a,d,p?lt.errorAsStream(a,p):h)}},close:function(f){if(u=null,i.ended=!0,!i.closed&&(i.closed=!0,t)){var s=t;t=null,s(f)}}}),i=ui(ve(u,function(){}));return i=n?n(i):i,i.remoteCall=function(f,s,o,l){if(s==="emit")return u.message(o);if(!(at(f)||pt(f)))throw new Error("unsupported type:"+JSON.stringify(f));if(at(f))return u.request({name:s,args:o},l);var a=u.stream(),p=ve[f](a,l);return a.write({name:s,args:o,type:f}),p},i.isOpen=function(){return!u.ended},i.close=function(f,s){return ii(f)&&(s=f,f=!1),u?f?(u.destroy(f),s&&s()):(u.close(function(o){if(s)s(o);else if(o)throw ct(o,"no callback provided for muxrpc close")}),this):s&&s()},i.closed=!1,i}});var vt=c((jo,dt)=>{"use strict";var ai=D(),pi=de();function hi(e){return typeof e=="function"}function di(e){return e&&typeof e=="object"}function qe(e,r,n,t){for(var u in r)(function(i,f){var s=n?n.concat(i):[i];e[i]=di(f)?qe({},f,s,t):function(){return t(f,s,[].slice.call(arguments))}})(u,r[u]);return e}function vi(e){if(e)throw pi(e,"callback not provided")}var qi=["sync","async"];dt.exports=function(e,r,n,t){e=e||{};function u(i,f,s){var o=hi(s[s.length-1])?s.pop():qi.includes(i)?null:vi,l;if(typeof o=="function"){try{l=n(i,f,s,o)}catch(a){return ai.errorAsStreamOrCb(i,a,o)}return l}else return new Promise((a,p)=>n(i,f,s,(h,d)=>{h?p(h):a(d)}))}return t?u("async","manifest",[function(i,f){if(i)return t(i);qe(e,f,null,u),t(null,f,e)}]):qe(e,r,null,u),e}});var gt=c((bo,qt)=>{"use strict";var $=D(),yt=Array.isArray;function z(e){return typeof e=="function"}function xt(e){return yt(e)?e:e.split(".")}function yi(e){return e&&z(e.pre)&&z(e.test)&&z(e.post)}qt.exports=function(e){if(yi(e))return e;if(z(e))return{pre:e};var r=null,n={};function t(u){return u.allow?(r={},u.allow.forEach(function(i){$.set(r,xt(i),!0)})):r=null,u.deny?u.deny.forEach(function(i){$.set(n,xt(i),!0)}):n={},this}return e&&t(e),t.pre=function(u){if(u=yt(u)?u:[u],r&&!$.prefix(r,u))return new Error("method:"+u+" is not in list of allowed methods");if(n&&$.prefix(n,u))return new Error("method:"+u+" is on list of disallowed methods")},t.post=function(){},t.test=function(u){return t.pre(u)},t.get=function(){return{allow:r,deny:n}},t}});var mt=c((es,wt)=>{var xi=gt(),ye=D();wt.exports=function(r,n,t){t=xi(t);function u(f,s){return f===ye.get(n,s)}function i(f,s,o){if(s==="emit")throw new Error("emit has been removed");if(f==="async"&&u("sync",s)){var l=o.pop(),a;try{a=ye.get(r,s).apply(this,o)}catch(p){return l(p)}return l(null,a)}if(!u(f,s))throw new Error("no "+f+":"+s);return ye.get(r,s).apply(this,o)}return function(f,s,o){var l=t.pre(s,o);if(l)throw l;return i.call(this,f,s,o)}}});var kt=c((rs,_t)=>{"use strict";var gi=Kr(),wi=ht(),mi=vt(),_i=mt(),Ei=require("events").EventEmitter;function Et(e,r,n,t,u,i,f){var s;typeof e=="function"&&(s=e,e={}),r=r||{},e=e||{};var o=new Ei;i||(i=gi);var l,a={_emit:function(d,v){return o&&o._emit(d,v),a},id:t},p=wi(_i(n,r,u).bind(a),i,function(d){if(!o.closed&&(o.closed=!0,o.emit("closed"),l)){var v=l;l=null,v(d)}});if(mi(o,e,function(d,v,g,I){if(p.closed)throw new Error("stream is closed");return p.remoteCall(d,v,g,I)},s),o._emit=o.emit,f){Object.__defineGetter__.call(o,"id",function(){return a.id}),Object.__defineSetter__.call(o,"id",function(d){a.id=d});var h=!0;o.createStream=function(d){if(l=d,h)return h=!1,p;throw new Error("one stream per rpc")}}else o.stream=p;return o.closed=!1,o.close=function(d,v){return p.close(d,v),this},o}_t.exports=function(e,r,n){return arguments.length>3?Et.apply(this,arguments):function(t,u,i){return Et(e,r,t,i,u,n,!0)}}});var Ot=c((x,St)=>{var ns=ue(),ki=ie();function Bt(e){e.destroy?e.destroy():console.error("warning, stream-to-pull-stream: \nthe wrapped node-stream does not implement `destroy`, \nthis may cause resource leaks.")}function Pt(e,r,n){var t,u=!1,i;function f(){i||(i=!0,n&&n(t===!0?null:t))}function s(){u||(u=!0,l(),t?f():e(t=!0,f))}function o(a){l(),t||e(t=a,f)}function l(){r.on("finish",s),r.removeListener("close",s),r.removeListener("error",o)}r.on("close",s),r.on("finish",s),r.on("error",o),process.nextTick(function(){ki(function(a){e(null,function(p,h){if(t=t||p,p===!0)return r._isStdio?f():r.end();if(t=t||p)return Bt(r),f(t);if(r._isStdio)r.write(h,function(){a()});else{var d=r.write(h);d===!1?r.once("drain",a):a()}})})})}function Si(e){var r=!1,n=!1,t;function u(){var i=e.read();if(i!==null&&t){var f=t;t=null,f(null,i)}}return e.on("readable",function(){n=!0,t&&u()}).on("end",function(){r=!0,t&&t(r)}).on("error",function(i){r=i,t&&t(r)}),function(i,f){t=f,r?f(r):n&&u()}}function V(e){var r=[],n=[],t,u=!1,i;function f(){for(;(r.length||t)&&n.length;)n.shift()(r.length?null:t,r.shift());!r.length&&u&&(u=!1,e.resume())}return e.on("data",function(s){r.push(s),f(),r.length&&e.pause&&(u=!0,e.pause())}),e.on("end",function(){t=!0,f()}),e.on("close",function(){t=!0,f()}),e.on("error",function(s){t=s,f()}),function(s,o){if(!o)throw new Error("*must* provide cb");if(s){let a=function(){for(;n.length;)n.shift()(s);o(s)};var l=a;if(t)return a();e.once("close",a),Bt(e)}else n.push(o),f()}}var Bi=V,X=function(e,r){return function(n){return Pt(n,e,r)}},Z=function(e){return V(e)};x=St.exports=function(e,r){return e.writable&&e.write?e.readable?function(n){return Pt(n,e,r),V(e)}:X(e,r):Z(e)};x.sink=X;x.source=Z;x.read=Bi;x.read1=V;x.read2=Si;x.duplex=function(e,r){return{source:Z(e),sink:X(e,r)}};x.transform=function(e){return function(r){var n=Z(e);return X(e)(r),n}}});me(exports);Mt(exports,{logThrough:()=>Nt});var At=P(require("net")),Tt=P(require("http")),j=P(require("fs")),xe=P(require("child_process")),ge=P(M()),we=P(require("util")),Pi=kt(),N=Ot(),Ct=JSON.parse(process.env.REMOTE_CONTAINERS_SOCKETS),Oi=_(_({},Ct.reduce((e,r)=>(e[r]="duplex",e),{})),{rpc:"async",ready:"async"}),Ai={exec:"async",stdin:"sink",stdout:"source",stderr:"source",exit:"async",terminate:"async",dispose:"async",execToEnd:"async"},B={},Ti=0,b=Pi(Oi,Ai)({exec:(e,r)=>{let n=e.cwd,t=e.env?_(_({},process.env),e.env):process.env,u=xe.spawn(e.cmd,e.args,{cwd:n,env:t,windowsHide:!0}),i=Ti++;B[i]={process:u,exit:new Promise((f,s)=>{u.once("error",s),u.once("close",(o,l)=>{f({code:o,signal:l})})}),stdin:N.sink(u.stdin),stdout:N.source(u.stdout),stderr:N.source(u.stderr)},r(null,i)},stdin:e=>B[e].stdin,stdout:e=>B[e].stdout,stderr:e=>B[e].stderr,exit:(e,r)=>{B[e].exit.then(n=>r(null,n),r)},terminate:(e,r)=>{B[e].process.kill("SIGKILL"),r()},dispose:(e,r)=>{delete B[e],r()},execToEnd:(e,r)=>{let n=e.cwd,t=e.env?_(_({},process.env),e.env):process.env,u=xe.spawn(e.cmd,e.args,{cwd:n,env:t,windowsHide:!0}),i=[];u.stdout.on("data",s=>i.push(s));let f=[];u.stderr.on("data",s=>f.push(s)),u.once("error",r),u.once("close",(s,o)=>{r(null,{stdout:Buffer.concat(i),stderr:Buffer.concat(f),code:s,signal:o})})}});(0,ge.default)(N.source(process.stdin),b.createStream(),N.sink(process.stdout));function Nt(e){return function(n,t){e(n,function(u,i){console.error(`logThrough: ${i==null?void 0:i.toString()}`),t(u,i)})}}var It=Ct.map(async e=>{try{if(!(await(0,we.promisify)(j.lstat)(e)).isSocket())return;await(0,we.promisify)(j.unlink)(e)}catch(n){if(!(n&&n.code==="ENOENT"))throw n}let r=At.createServer(n=>{n=N.duplex(n),(0,ge.default)(n,b[e](t=>{t&&console.error("Remote to local stream terminated with error:",t)}),n)});return new Promise(n=>r.listen(e,n))}),Rt;It.push(new Promise(e=>Rt=e));Tt.createServer((e,r)=>{let n=[];e.on("data",t=>n.push(t)),e.on("end",()=>{b.rpc(Buffer.concat(n).toString(),(t,u)=>{t?(console.error(t),r.writeHead(500),r.end()):(r.writeHead(200),r.write(u,i=>{i&&console.error(i)}),r.end())})})}).listen(process.env.REMOTE_CONTAINERS_IPC,Rt);Promise.all(It).then(()=>b.ready(e=>{e&&console.error(e)})).catch(e=>console.error(e));0&&(module.exports={logThrough});
//# sourceMappingURL=remoteContainersServer.js.map
